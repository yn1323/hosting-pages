import{G as x,r as d,j as s,B as F,M as I}from"./iframe-CPNykFu4.js";import{g as _,e as N,u as V,s as w}from"./states-BgKcEv6C.js";import{R as D}from"./responsive-modal-DETIp2Db.js";import{a as k}from"./useModal-JLMgYJoB.js";import{S as T,m as W}from"./index-_BsFM55Z.js";import{n as y}from"./index-DFT-raW7.js";import{V as S}from"./v-stack-ZFthQQXO.js";import{T as M}from"./index-DeSftEHM.js";const P=W(F),q=I(a=>{const m=a(V),u=a(w),{round:n}=a(_),f=n-1,r=u.filter(e=>e.round===f),l=r.reduce((e,t)=>(e[t.item]||(e[t.item]=[]),e[t.item].push(t),e),{}),c=new Set;return Object.values(l).forEach(e=>{if(e.length>1){const t=Math.max(...e.map(o=>o.randomNumber));e.forEach(o=>{o.randomNumber!==t&&c.add(o.userId)})}}),m.map(e=>{const t=r.find(o=>o.userId===e.id);return{id:e.id,name:e.name,avatar:e.avatar,choice:(t==null?void 0:t.item)||"",willLose:c.has(e.id)}})}),C=()=>k(["card","typing","slot"],"card"),v=({isOpen:a,onClose:m,variant:u})=>{const n=y("draft"),f=y("common"),r=x(q),l=d.useMemo(()=>r.map(p=>({...p,choice:p.choice||n("stageModal.selecting")})),[r,n]),c=x(N),{round:e}=x(_),[t,o]=d.useState(!1),[b,g]=d.useState(!1);d.useEffect(()=>{a?(o(!0),g(!1)):(o(!1),g(!1))},[a]),d.useEffect(()=>{if(a&&t){const p=e-1;if(c.some(i=>i.round===p)){let i=0;const h=r.length;switch(u){case"card":i=h*800+600+500+1e3;break;case"typing":{const B=Math.max(...l.map(E=>E.choice.length));i=h*1e3+B*80+300+1e3;break}case"slot":i=(h-1)*500+3e3+500+1e3;break}const A=setTimeout(()=>{g(!0)},i);return()=>clearTimeout(A)}}},[a,t,u,c,e,l,r]);const R=()=>{o(!0)},j=()=>{o(!1)};return s.jsx(D,{isOpen:a,onClose:m,title:n("stageModal.title"),dialogMaxWidth:"4xl",actions:{cancel:{text:f("actions.close"),onClick:m}},children:s.jsxs(S,{gap:4,w:"full",children:[s.jsx(T,{variant:u,participants:l,isRevealing:t,onStartReveal:R,onReset:j}),b&&s.jsx(P,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},w:"full",bg:"red.50",border:"2px solid",borderColor:"red.200",borderRadius:"lg",p:4,children:s.jsxs(S,{gap:2,align:"start",children:[s.jsxs(F,{display:"flex",alignItems:"center",gap:2,children:[s.jsx(M,{fontSize:"lg",children:"⚠️"}),s.jsx(M,{fontSize:"md",fontWeight:"bold",color:"red.700",children:n("stageModal.clashWarning")})]}),s.jsxs(M,{fontSize:"sm",color:"red.600",lineHeight:"1.5",children:[n("stageModal.clashInstruction"),s.jsx("br",{}),n("stageModal.clashBlock"),s.jsx("br",{}),n("stageModal.clashNote")]})]})})]})})};try{C.displayName="useStageModal",C.__docgenInfo={description:`StageModal用のカスタムフック
汎用useModalWithVariantを利用した軽量実装`,displayName:"useStageModal",props:{}}}catch{}try{v.displayName="StageModal",v.__docgenInfo={description:`開票演出を表示するモーダルコンポーネント
ResponsiveModalを使用して、SP/PCで最適な表示を実現`,displayName:"StageModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"enum",value:[{value:'"slot"'},{value:'"card"'},{value:'"typing"'}]}}}}}catch{}export{v as S,C as u};
