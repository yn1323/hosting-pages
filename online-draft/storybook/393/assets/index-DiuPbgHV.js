import{c as X}from"./factory-tkGIaEWB.js";import{ab as H,r as s,aT as K,av as Q,aU as h,aV as k,aW as j,aX as tt,aY as q,aw as _,aZ as et,a_ as nt,a$ as rt}from"./iframe-esjyWdrP.js";const[ft,it]=X({name:"EnvironmentContext",hookName:"useEnvironmentContext",providerName:"<EnvironmentProvider />",strict:!1,defaultValue:{getRootNode:()=>document,getDocument:()=>document,getWindow:()=>window}}),[lt,dt]=X({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}}),gt=()=>(t,o)=>o.reduce((c,f)=>{const[d,g]=c,E=f;return g[E]!==void 0&&(d[E]=g[E]),delete g[E],[d,g]},[{},{...t}]);var P=H(),Y=typeof globalThis.document<"u"?s.useLayoutEffect:s.useEffect;function z(t){const o=t().value??t().defaultValue,c=t().isEqual??Object.is,[f]=s.useState(o),[d,g]=s.useState(f),E=t().value!==void 0,y=s.useRef(d);y.current=E?t().value:d;const C=s.useRef(y.current);Y(()=>{C.current=y.current},[d,t().value]);const b=R=>{var m,M;const i=C.current,l=q(R)?R(i):R;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:l,prev:i}),E||g(l),c(l,i)||(M=(m=t()).onChange)==null||M.call(m,l,i)};function w(){return E?t().value:d}return{initial:f,ref:y,get:w,set(R){(t().sync?P.flushSync:tt)(()=>b(R))},invoke(R,i){var l,m;(m=(l=t()).onChange)==null||m.call(l,R,i)},hash(R){var i,l;return((l=(i=t()).hash)==null?void 0:l.call(i,R))??String(R)}}}z.cleanup=t=>{s.useEffect(()=>t,[])};z.ref=t=>{const o=s.useRef(t);return{get:()=>o.current,set:c=>{o.current=c}}};function ut(t){const o=s.useRef(t);return{get(c){return o.current[c]},set(c,f){o.current[c]=f}}}var ot=(t,o)=>{const c=s.useRef(!1),f=s.useRef(!1);s.useEffect(()=>{if(c.current&&f.current)return o();f.current=!0},[...(t??[]).map(d=>typeof d=="function"?d():d)]),s.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[])};function vt(t,o={}){var I,J,U,W;const c=s.useMemo(()=>{const{id:n,ids:e,getRootNode:r}=o;return K({id:n,ids:e,getRootNode:r})},[o]),f=(...n)=>{t.debug&&console.log(...n)},d=((I=t.props)==null?void 0:I.call(t,{props:Q(o),scope:c}))??o,g=st(d),E=(J=t.context)==null?void 0:J.call(t,{prop:g,bindable:z,scope:c,flush:B,getContext(){return C},getComputed(){return T},getRefs(){return M},getEvent(){return l()}}),y=Z(E),C={get(n){var e;return(e=y.current)==null?void 0:e[n].ref.current},set(n,e){var r;(r=y.current)==null||r[n].set(e)},initial(n){var e;return(e=y.current)==null?void 0:e[n].initial},hash(n){var r,u;const e=(r=y.current)==null?void 0:r[n].get();return(u=y.current)==null?void 0:u[n].hash(e)}},b=s.useRef(new Map),w=s.useRef(null),R=s.useRef(null),i=s.useRef({type:""}),l=()=>({...i.current,current(){return i.current},previous(){return R.current}}),m=()=>({...p,matches(...n){return n.includes(p.ref.current)},hasTag(n){var e,r;return!!((r=(e=t.states[p.ref.current])==null?void 0:e.tags)!=null&&r.includes(n))}}),M=ut(((U=t.refs)==null?void 0:U.call(t,{prop:g,context:C}))??{}),N=()=>({state:m(),context:C,event:l(),prop:g,send:F,action:V,guard:$,track:ot,refs:M,computed:T,flush:B,scope:c,choose:O}),V=n=>{const e=q(n)?n(N()):n;if(!e)return;const r=e.map(u=>{var v,S;const a=(S=(v=t.implementations)==null?void 0:v.actions)==null?void 0:S[u];return a||_(`[zag-js] No implementation found for action "${JSON.stringify(u)}"`),a});for(const u of r)u==null||u(N())},$=n=>{var e,r;return q(n)?n(N()):(r=(e=t.implementations)==null?void 0:e.guards)==null?void 0:r[n](N())},D=n=>{const e=q(n)?n(N()):n;if(!e)return;const r=e.map(a=>{var S,x;const v=(x=(S=t.implementations)==null?void 0:S.effects)==null?void 0:x[a];return v||_(`[zag-js] No implementation found for effect "${JSON.stringify(a)}"`),v}),u=[];for(const a of r){const v=a==null?void 0:a(N());v&&u.push(v)}return()=>u.forEach(a=>a==null?void 0:a())},O=n=>et(n).find(e=>{let r=!e.guard;return nt(e.guard)?r=!!$(e.guard):q(e.guard)&&(r=e.guard(N())),r}),T=n=>{h(t.computed,()=>"[zag-js] No computed object found on machine");const e=t.computed[n];return e({context:C,event:l(),prop:g,refs:M,scope:c,computed:T})},p=z(()=>({defaultValue:t.initialState({prop:g}),onChange(n,e){var u,a,v,S;if(e){const x=b.current.get(e);x==null||x(),b.current.delete(e)}e&&V((u=t.states[e])==null?void 0:u.exit),V((a=w.current)==null?void 0:a.actions);const r=D((v=t.states[n])==null?void 0:v.effects);if(r&&b.current.set(n,r),e===j){V(t.entry);const x=D(t.effects);x&&b.current.set(j,x)}V((S=t.states[n])==null?void 0:S.entry)}})),A=s.useRef(void 0),L=s.useRef(k.NotStarted);Y(()=>{queueMicrotask(()=>{const r=L.current===k.Started;L.current=k.Started,f(r?"rehydrating...":"initializing...");const u=A.current??p.initial;p.invoke(u,r?p.get():j)});const n=b.current,e=p.ref.current;return()=>{f("unmounting..."),A.current=e,L.current=k.Stopped,n.forEach(r=>r==null?void 0:r()),b.current=new Map,w.current=null,queueMicrotask(()=>{V(t.exit)})}},[]);const G=()=>"ref"in p?p.ref.current:p.get(),F=n=>{queueMicrotask(()=>{var S,x;if(L.current!==k.Started)return;R.current=i.current,i.current=n;let e=G();const r=((S=t.states[e].on)==null?void 0:S[n.type])??((x=t.on)==null?void 0:x[n.type]),u=O(r);if(!u)return;w.current=u;const a=u.target??e;f("transition",n.type,u.target||e,`(${u.actions})`);const v=a!==e;v?P.flushSync(()=>p.set(a)):u.reenter&&!v?p.invoke(e,e):V(u.actions??[])})};return(W=t.watch)==null||W.call(t,N()),{state:m(),send:F,context:C,prop:g,scope:c,refs:M,computed:T,event:l(),getStatus:()=>L.current}}function Z(t){const o=s.useRef(t);return o.current=t,o}function st(t){const o=Z(t);return function(f){return o.current[f]}}function B(t){queueMicrotask(()=>{P.flushSync(()=>t())})}var Rt=rt(t=>t);export{dt as a,vt as b,gt as c,Rt as n,P as r,it as u};
