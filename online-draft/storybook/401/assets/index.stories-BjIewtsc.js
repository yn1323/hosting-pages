import{c as Te,d as Je,b as Xe,s as Ie,T as P}from"./index.esm-ClM2GOLW.js";import{r as _e,R as Se,S as Ye,T as Qe,U as er,V as rr,W as or,X as tr,Y as nr,Z as ar,_ as sr,$ as ir,a0 as ur,M as lr,j as a,B as ye,H as cr}from"./iframe-C_rgkzEe.js";import{B as dr}from"./index-DA8pZe5w.js";import{L as fr}from"./index-BNyOP1EO.js";import{u as pr}from"./toaster-De9rtTUk.js";import{d as Ne,v as G,a as mr}from"./common-CxXojnM3.js";import{u as vr}from"./useFirebaseAuth-R5uIcELV.js";import{a as gr,u as _r}from"./useRealtimeUsers-C9cxQBql.js";import{r as yr}from"./index-C2bVUVc_.js";import{A as br}from"./index-C3Myi0m9.js";import{P as hr}from"./index-Bp3spJU-.js";import{R as Cr}from"./index-FDxIu2KK.js";import{C as be}from"./container-swfPgt7F.js";import{V as qe}from"./v-stack-BdZrG5lB.js";import{T as Q}from"./index-DvCjFio_.js";import"./preload-helper-Dp1pzeXC.js";import"./create-slot-recipe-context-D1cBH6vL.js";import"./index-e3sGAjzz.js";import"./factory-BjdDSQJN.js";import"./zod-B8d8-S5d.js";import"./index-B8p9ccOV.js";import"./responsive-modal-DxvuhESA.js";import"./render-strategy-Dzi14LDJ.js";import"./use-breakpoint-FjEkCHs-.js";import"./simple-grid-j66pcus2.js";import"./grid-UoGbtoX6.js";import"./index-BLk1nnUV.js";import"./card-5bvOAfB8.js";import"./h-stack-kLvObkFg.js";const Ar=()=>{const r=Te(Ne,"_temp");return Je(r).id},Dr=()=>{const r=Te(Ne,"app/onlinedraft/user");return{createUser:_e.useCallback(async(s,v,g,t)=>{G(s,"グループID"),G(v,"ユーザー名"),mr(v,20,"ユーザー名"),G(g,"アバター"),G(t,"ユーザーID");const i={userId:t,userName:v.trim(),groupId:s.trim(),avatar:g.trim()};try{const h=Je(r,t);await Xe(h,{...i,joinedAt:Ie(),updatedAt:Ie()})}catch(h){throw h instanceof Error?new Error(`ユーザー作成に失敗しました: ${h.message}`):new Error("ユーザー作成中に予期しないエラーが発生しました")}},[r]),userCollection:r}};var W={exports:{}},$={exports:{}},Pe;function Rr(){return Pe||(Pe=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useIntersection",{enumerable:!0,get:function(){return U}});const s=Se(),v=Ye(),g=typeof IntersectionObserver=="function",t=new Map,i=[];function h(_){const l={root:_.root||null,margin:_.rootMargin||""},k=i.find(b=>b.root===l.root&&b.margin===l.margin);let u;if(k&&(u=t.get(k),u))return u;const C=new Map,y=new IntersectionObserver(b=>{b.forEach(c=>{const L=C.get(c.target),A=c.isIntersecting||c.intersectionRatio>0;L&&A&&L(A)})},_);return u={id:l,observer:y,elements:C},i.push(l),t.set(l,u),u}function x(_,l,k){const{id:u,observer:C,elements:y}=h(k);return y.set(_,l),C.observe(_),function(){if(y.delete(_),C.unobserve(_),y.size===0){C.disconnect(),t.delete(u);const c=i.findIndex(L=>L.root===u.root&&L.margin===u.margin);c>-1&&i.splice(c,1)}}}function U(_){let{rootRef:l,rootMargin:k,disabled:u}=_;const C=u||!g,[y,b]=(0,s.useState)(!1),c=(0,s.useRef)(null),L=(0,s.useCallback)(D=>{c.current=D},[]);(0,s.useEffect)(()=>{if(g){if(C||y)return;const D=c.current;if(D&&D.tagName)return x(D,N=>N&&b(N),{root:l==null?void 0:l.current,rootMargin:k})}else if(!y){const D=(0,v.requestIdleCallback)(()=>b(!0));return()=>(0,v.cancelIdleCallback)(D)}},[C,k,l,y,c.current]);const A=(0,s.useCallback)(()=>{b(!1)},[]);return[L,y,A]}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)})($,$.exports)),$.exports}var z={exports:{}},xe;function Fr(){return xe||(xe=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getDomainLocale",{enumerable:!0,get:function(){return s}}),Qe();function s(v,g,t,i){return!1}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)})(z,z.exports)),z.exports}var ee={},Ue;function kr(){return Ue||(Ue=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return e}});let e=s=>{}})(ee)),ee}var we;function Lr(){return we||(we=1,(function(r,e){"use client";Object.defineProperty(e,"__esModule",{value:!0});function s(n,R){for(var p in R)Object.defineProperty(n,p,{enumerable:!0,get:R[p]})}s(e,{default:function(){return Ze},useLinkStatus:function(){return He}});const v=rr(),g=er(),t=v._(Se()),i=or(),h=tr(),x=nr(),U=ar(),_=sr(),l=ir(),k=Rr(),u=Fr(),C=ur(),y=yr();kr();const b=new Set;function c(n,R,p,m){if(!(typeof window>"u")&&(0,h.isLocalURL)(R)){if(!m.bypassPrefetchedCheck){const j=typeof m.locale<"u"?m.locale:"locale"in n?n.locale:void 0,E=R+"%"+p+"%"+j;if(b.has(E))return;b.add(E)}n.prefetch(R,p,m).catch(j=>{})}}function L(n){const p=n.currentTarget.getAttribute("target");return p&&p!=="_self"||n.metaKey||n.ctrlKey||n.shiftKey||n.altKey||n.nativeEvent&&n.nativeEvent.which===2}function A(n,R,p,m,j,E,V,X,H){const{nodeName:Y}=n.currentTarget;if(Y.toUpperCase()==="A"&&L(n)||n.currentTarget.hasAttribute("download"))return;if(!(0,h.isLocalURL)(p)){j&&(n.preventDefault(),location.replace(p));return}n.preventDefault(),(()=>{if(H){let O=!1;if(H({preventDefault:()=>{O=!0}}),O)return}const I=V??!0;"beforePopState"in R?R[j?"replace":"push"](p,m,{shallow:E,locale:X,scroll:I}):R[j?"replace":"push"](m||p,{scroll:I})})()}function D(n){return typeof n=="string"?n:(0,x.formatUrl)(n)}const w=t.default.forwardRef(function(R,p){let m;const{href:j,as:E,children:V,prefetch:X=null,passHref:H,replace:Y,shallow:he,scroll:Ce,locale:I,onClick:O,onNavigate:Ge,onMouseEnter:Ae,onTouchStart:De,legacyBehavior:M=!1,...We}=R;m=V,M&&(typeof m=="string"||typeof m=="number")&&(m=(0,g.jsx)("a",{children:m}));const o=t.default.useContext(l.RouterContext),Re=X!==!1,{href:q,as:F}=t.default.useMemo(()=>{if(!o){const Ee=D(j);return{href:Ee,as:E?D(E):Ee}}const[f,B]=(0,i.resolveHref)(o,j,!0);return{href:f,as:E?(0,i.resolveHref)(o,E):B||f}},[o,j,E]),Fe=t.default.useRef(q),ke=t.default.useRef(F);let d;M&&(d=t.default.Children.only(m));const $e=M?d&&typeof d=="object"&&d.ref:p,[Le,Me,je]=(0,k.useIntersection)({rootMargin:"200px"}),ze=t.default.useCallback(f=>{(ke.current!==F||Fe.current!==q)&&(je(),ke.current=F,Fe.current=q),Le(f)},[F,q,je,Le]),Ke=(0,y.useMergedRef)(ze,$e);t.default.useEffect(()=>{o&&(!Me||!Re||c(o,q,F,{locale:I}))},[F,q,Me,I,Re,o==null?void 0:o.locale,o]);const Z={ref:Ke,onClick(f){!M&&typeof O=="function"&&O(f),M&&d.props&&typeof d.props.onClick=="function"&&d.props.onClick(f),o&&(f.defaultPrevented||A(f,o,q,F,Y,he,Ce,I,Ge))},onMouseEnter(f){!M&&typeof Ae=="function"&&Ae(f),M&&d.props&&typeof d.props.onMouseEnter=="function"&&d.props.onMouseEnter(f),o&&c(o,q,F,{locale:I,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(B){!M&&typeof De=="function"&&De(B),M&&d.props&&typeof d.props.onTouchStart=="function"&&d.props.onTouchStart(B),o&&c(o,q,F,{locale:I,priority:!0,bypassPrefetchedCheck:!0})}};if((0,U.isAbsoluteUrl)(F))Z.href=F;else if(!M||H||d.type==="a"&&!("href"in d.props)){const f=typeof I<"u"?I:o==null?void 0:o.locale,B=(o==null?void 0:o.isLocaleDomain)&&(0,u.getDomainLocale)(F,f,o==null?void 0:o.locales,o==null?void 0:o.domainLocales);Z.href=B||(0,C.addBasePath)((0,_.addLocale)(F,f,o==null?void 0:o.defaultLocale))}return M?t.default.cloneElement(d,Z):(0,g.jsx)("a",{...We,...Z,children:m})}),N=(0,t.createContext)({pending:!1}),He=()=>(0,t.useContext)(N),Ze=w;(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)})(W,W.exports)),W.exports}var re,Be;function Mr(){return Be||(Be=1,re=Lr()),re}var jr=Mr();const Er=lr(jr),K=({group:r,users:e,roomUrl:s,isAvatarModalOpen:v,usedAvatars:g,onJoinClick:t,onUserSelect:i,onAvatarModalClose:h,onJoinConfirm:x})=>r?a.jsxs(ye,{bg:"gray.50",minH:"100vh",py:[4,8],children:[a.jsx(be,{maxW:"container.lg",children:a.jsxs(qe,{gap:6,w:"full",children:[a.jsx(Q,{fontSize:["xl","2xl"],fontWeight:"bold",color:"gray.800",children:"ドラフトルーム"}),a.jsx(Cr,{group:r,roomUrl:s}),a.jsx(hr,{users:e||[],onJoinClick:t,onUserSelect:i}),a.jsx(Er,{href:"/",children:a.jsx(dr,{variant:"outline",size:"sm",children:"ルームを退出"})})]})}),a.jsx(br,{isOpen:v,onClose:h,onConfirm:x,usedAvatars:g})]}):a.jsx(ye,{bg:"gray.50",minH:"100vh",py:[4,8],children:a.jsx(be,{maxW:"container.lg",children:a.jsxs(qe,{gap:6,children:[a.jsx(Q,{fontSize:["xl","2xl"],fontWeight:"bold",color:"red.600",children:"ルームが見つかりません"}),a.jsx(Q,{color:"gray.600",children:"指定されたルームが存在しないか、削除されている可能性があります。"})]})})}),Oe=({groupId:r})=>{const{isAuthenticated:e,signInAnonymous:s,loading:v}=vr(),{group:g,loading:t}=gr(r),{users:i,loading:h}=_r(r),{createUser:x}=Dr(),U=cr(),[_,l]=_e.useState(!1),{errorToast:k,successToast:u}=pr();_e.useEffect(()=>{},[e,v,s,k]);const C=window.location.href,y=t||h||!1,b=(i==null?void 0:i.map(A=>A.avatar))||[],c=async A=>{const D=Ar();try{await x(r,A.name,A.avatar,D),sessionStorage.setItem("onlinedraft_user_id",D),U.push(`/draft/${r}`),u("ドラフトに参加しました！")}catch(w){console.error("参加エラー:",w),k(w instanceof Error?w.message:"参加に失敗しました")}},L=A=>{sessionStorage.setItem("onlinedraft_user_id",A),U.push(`/draft/${r}`),u("ドラフトに参加しました！")};return y||!e||v||!g?a.jsx(ye,{bg:"gray.50",minH:"100vh",py:[4,8],children:a.jsx(be,{maxW:"container.lg",children:a.jsx(fr,{message:"ローディング中..."})})}):a.jsx(K,{group:g,users:i,roomUrl:C,isAvatarModalOpen:_,usedAvatars:b,onJoinClick:()=>l(!0),onUserSelect:L,onAvatarModalClose:()=>l(!1),onJoinConfirm:c})};try{K.displayName="LobbyPageInner",K.__docgenInfo={description:`ロビー画面Innerコンポーネント（Presenter）
UI描画のみを担当、propsでデータとハンドラーを受け取る
Firebaseやビジネスロジックには依存しない純粋なUIコンポーネント`,displayName:"LobbyPageInner",props:{group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"GroupDataType | null"}},users:{defaultValue:null,description:"",name:"users",required:!0,type:{name:"UserDataType[] | null"}},roomUrl:{defaultValue:null,description:"",name:"roomUrl",required:!0,type:{name:"string"}},isAvatarModalOpen:{defaultValue:null,description:"",name:"isAvatarModalOpen",required:!0,type:{name:"boolean"}},usedAvatars:{defaultValue:null,description:"",name:"usedAvatars",required:!0,type:{name:"string[]"}},onJoinClick:{defaultValue:null,description:"",name:"onJoinClick",required:!0,type:{name:"() => void"}},onUserSelect:{defaultValue:null,description:"",name:"onUserSelect",required:!0,type:{name:"(userId: string) => void"}},onAvatarModalClose:{defaultValue:null,description:"",name:"onAvatarModalClose",required:!0,type:{name:"() => void"}},onJoinConfirm:{defaultValue:null,description:"",name:"onJoinConfirm",required:!0,type:{name:"(userData: { name: string; avatar: string; }) => void"}}}}}catch{}try{Oe.displayName="LobbyPage",Oe.__docgenInfo={description:`ロビー画面コンポーネント（Container）
ロジック・データ取得・認証のみを担当
LobbyPageInnerにpropsを渡すのみ`,displayName:"LobbyPage",props:{groupId:{defaultValue:null,description:"",name:"groupId",required:!0,type:{name:"string"}}}}}catch{}var oe,te,ne,ae,se,ie,ue,le,ce,de,fe,pe,me,ve,ge;const io={title:"features/lobby/LobbyPage",component:K,parameters:{layout:"fullscreen"}},Ve={groupName:"2024年プロ野球ドラフト",deleteFlg:!1,finishedRound:[],round:1,createdAt:P.fromDate(new Date("2024-06-17T10:00:00Z")),updatedAt:P.fromDate(new Date("2024-06-17T10:00:00Z"))},Ir=[{userId:"user1",userName:"たろう",groupId:"group123",avatar:"1",joinedAt:P.fromDate(new Date("2024-06-17T10:00:00Z")),updatedAt:P.fromDate(new Date("2024-06-17T10:00:00Z")),isActive:!0},{userId:"user2",userName:"はなこ",groupId:"group123",avatar:"2",joinedAt:P.fromDate(new Date("2024-06-17T10:05:00Z")),updatedAt:P.fromDate(new Date("2024-06-17T10:05:00Z")),isActive:!0},{userId:"user3",userName:"じろう",groupId:"group123",avatar:"3",joinedAt:P.fromDate(new Date("2024-06-17T10:10:00Z")),updatedAt:P.fromDate(new Date("2024-06-17T10:10:00Z")),isActive:!1}],T={args:{group:Ve,users:Ir,roomUrl:"https://onlinedraft.com/lobby/abc123",isAvatarModalOpen:!1,usedAvatars:["1","2","3"],onJoinClick:()=>console.log("Join clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}},J={args:{group:null,users:null,roomUrl:"",isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>{},onAvatarModalClose:()=>{},onJoinConfirm:()=>{}}},S={args:{group:{...Ve,groupName:"新規作成ルーム"},users:[],roomUrl:"https://onlinedraft.com/lobby/newroom123",isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>console.log("Join clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}};T.parameters={...T.parameters,docs:{...(oe=T.parameters)===null||oe===void 0?void 0:oe.docs,source:{originalSource:`{
  args: {
    group: mockGroup,
    users: mockUsers,
    roomUrl: 'https://onlinedraft.com/lobby/abc123',
    isAvatarModalOpen: false,
    usedAvatars: ['1', '2', '3'],
    onJoinClick: () => console.log('Join clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(ne=T.parameters)===null||ne===void 0||(te=ne.docs)===null||te===void 0?void 0:te.source},description:{story:`基本のロビーページ表示（3人参加）
Firebaseロジックを含まない純粋なUIテスト`,...(se=T.parameters)===null||se===void 0||(ae=se.docs)===null||ae===void 0?void 0:ae.description}}};J.parameters={...J.parameters,docs:{...(ie=J.parameters)===null||ie===void 0?void 0:ie.docs,source:{originalSource:`{
  args: {
    group: null,
    users: null,
    roomUrl: '',
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => {},
    onAvatarModalClose: () => {},
    onJoinConfirm: () => {}
  }
}`,...(le=J.parameters)===null||le===void 0||(ue=le.docs)===null||ue===void 0?void 0:ue.source},description:{story:"ルームが見つからない状態",...(de=J.parameters)===null||de===void 0||(ce=de.docs)===null||ce===void 0?void 0:ce.description}}};S.parameters={...S.parameters,docs:{...(fe=S.parameters)===null||fe===void 0?void 0:fe.docs,source:{originalSource:`{
  args: {
    group: {
      ...mockGroup,
      groupName: '新規作成ルーム'
    },
    users: [],
    roomUrl: 'https://onlinedraft.com/lobby/newroom123',
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => console.log('Join clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(me=S.parameters)===null||me===void 0||(pe=me.docs)===null||pe===void 0?void 0:pe.source},description:{story:"参加者なし（新規ルーム）",...(ge=S.parameters)===null||ge===void 0||(ve=ge.docs)===null||ve===void 0?void 0:ve.description}}};const uo=["Basic","RoomNotFound","EmptyRoom"];export{T as Basic,S as EmptyRoom,J as RoomNotFound,uo as __namedExportsOrder,io as default};
