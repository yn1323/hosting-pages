import{G as h,r as p,j as o,B as C,N as j}from"./iframe-RlG1jcEu.js";import{g as v,e as A,u as E,s as B}from"./states-TCS8mwE7.js";import{R as I}from"./responsive-modal-Bdo-IWTZ.js";import{a as N}from"./useModal-D_Wdx75F.js";import{S as V,m as w}from"./index-BML0wms3.js";import{V as x}from"./v-stack-DN8eplg_.js";import{T as g}from"./index-HKIpGz3m.js";const D=w(C),k=j(a=>{const d=a(E),i=a(B),{round:r}=a(v),m=r-1,l=i.filter(e=>e.round===m),c=l.reduce((e,t)=>(e[t.item]||(e[t.item]=[]),e[t.item].push(t),e),{}),n=new Set;return Object.values(c).forEach(e=>{if(e.length>1){const t=Math.max(...e.map(s=>s.randomNumber));e.forEach(s=>{s.randomNumber!==t&&n.add(s.userId)})}}),d.map(e=>{const t=l.find(s=>s.userId===e.id);return{id:e.id,name:e.name,avatar:e.avatar,choice:(t==null?void 0:t.item)||"選択中...",willLose:n.has(e.id)}})}),S=()=>N(["card","typing","slot"],"card"),y=({isOpen:a,onClose:d,variant:i})=>{const r=h(k),m=h(A),{round:l}=h(v),[c,n]=p.useState(!1),[e,t]=p.useState(!1);p.useEffect(()=>{a?(n(!0),t(!1)):(n(!1),t(!1))},[a]),p.useEffect(()=>{if(a&&c){const F=l-1;if(m.some(u=>u.round===F)){let u=0;const f=r.length;switch(i){case"card":u=f*800+600+500+1e3;break;case"typing":{const b=Math.max(...r.map(R=>R.choice.length));u=f*1e3+b*80+300+1e3;break}case"slot":u=(f-1)*500+3e3+500+1e3;break}const _=setTimeout(()=>{t(!0)},u);return()=>clearTimeout(_)}}},[a,c,i,m,l,r]);const s=()=>{n(!0)},M=()=>{n(!1)};return o.jsx(I,{isOpen:a,onClose:d,title:"開票演出",dialogMaxWidth:"4xl",actions:{cancel:{text:"閉じる",onClick:d}},children:o.jsxs(x,{gap:4,w:"full",children:[o.jsx(V,{variant:i,participants:r,isRevealing:c,onStartReveal:s,onReset:M}),e&&o.jsx(D,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},w:"full",bg:"red.50",border:"2px solid",borderColor:"red.200",borderRadius:"lg",p:4,children:o.jsxs(x,{gap:2,align:"start",children:[o.jsxs(C,{display:"flex",alignItems:"center",gap:2,children:[o.jsx(g,{fontSize:"lg",children:"⚠️"}),o.jsx(g,{fontSize:"md",fontWeight:"bold",color:"red.700",children:"重複指名が発生しました！"})]}),o.jsxs(g,{fontSize:"sm",color:"red.600",lineHeight:"1.5",children:["一覧画面で赤く表示されたドラフト結果から順番に編集してください。",o.jsx("br",{}),"重複指名をすべて編集するまで次のラウンドに進めません。",o.jsx("br",{}),"※重複指名の編集順はランダムに決まります"]})]})})]})})};try{S.displayName="useStageModal",S.__docgenInfo={description:`StageModal用のカスタムフック
汎用useModalWithVariantを利用した軽量実装`,displayName:"useStageModal",props:{}}}catch{}try{y.displayName="StageModal",y.__docgenInfo={description:`開票演出を表示するモーダルコンポーネント
ResponsiveModalを使用して、SP/PCで最適な表示を実現`,displayName:"StageModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"enum",value:[{value:'"slot"'},{value:'"card"'},{value:'"typing"'}]}}}}}catch{}export{y as S,S as u};
