import{c as X}from"./factory-DuFKs9iv.js";import{a1 as H,r as s,aX as K,az as Q,aY as h,aZ as q,a_ as j,a$ as tt,b0 as w,aA as U,b1 as et,b2 as nt,b3 as rt}from"./iframe-CPNykFu4.js";const[ft,it]=X({name:"EnvironmentContext",hookName:"useEnvironmentContext",providerName:"<EnvironmentProvider />",strict:!1,defaultValue:{getRootNode:()=>document,getDocument:()=>document,getWindow:()=>window}}),[lt,dt]=X({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}}),gt=()=>(t,o)=>o.reduce((c,f)=>{const[d,g]=c,E=f;return g[E]!==void 0&&(d[E]=g[E]),delete g[E],[d,g]},[{},{...t}]);var P=H(),Y=typeof globalThis.document<"u"?s.useLayoutEffect:s.useEffect;function T(t){const o=t().value??t().defaultValue,c=t().isEqual??Object.is,[f]=s.useState(o),[d,g]=s.useState(f),E=t().value!==void 0,b=s.useRef(d);b.current=E?t().value:d;const y=s.useRef(b.current);Y(()=>{y.current=b.current},[d,t().value]);const C=R=>{var m,M;const i=y.current,l=w(R)?R(i):R;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:l,prev:i}),E||g(l),c(l,i)||(M=(m=t()).onChange)==null||M.call(m,l,i)};function V(){return E?t().value:d}return{initial:f,ref:b,get:V,set(R){(t().sync?P.flushSync:tt)(()=>C(R))},invoke(R,i){var l,m;(m=(l=t()).onChange)==null||m.call(l,R,i)},hash(R){var i,l;return((l=(i=t()).hash)==null?void 0:l.call(i,R))??String(R)}}}T.cleanup=t=>{s.useEffect(()=>t,[])};T.ref=t=>{const o=s.useRef(t);return{get:()=>o.current,set:c=>{o.current=c}}};function ut(t){const o=s.useRef(t);return{get(c){return o.current[c]},set(c,f){o.current[c]=f}}}var ot=(t,o)=>{const c=s.useRef(!1),f=s.useRef(!1);s.useEffect(()=>{if(c.current&&f.current)return o();f.current=!0},[...(t??[]).map(d=>typeof d=="function"?d():d)]),s.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[])};function vt(t,o={}){var I,J,_,B;const c=s.useMemo(()=>{const{id:n,ids:e,getRootNode:r}=o;return K({id:n,ids:e,getRootNode:r})},[o]),f=(...n)=>{t.debug&&console.log(...n)},d=((I=t.props)==null?void 0:I.call(t,{props:Q(o),scope:c}))??o,g=st(d),E=(J=t.context)==null?void 0:J.call(t,{prop:g,bindable:T,scope:c,flush:W,getContext(){return y},getComputed(){return z},getRefs(){return M},getEvent(){return l()}}),b=Z(E),y={get(n){var e;return(e=b.current)==null?void 0:e[n].ref.current},set(n,e){var r;(r=b.current)==null||r[n].set(e)},initial(n){var e;return(e=b.current)==null?void 0:e[n].initial},hash(n){var r,u;const e=(r=b.current)==null?void 0:r[n].get();return(u=b.current)==null?void 0:u[n].hash(e)}},C=s.useRef(new Map),V=s.useRef(null),R=s.useRef(null),i=s.useRef({type:""}),l=()=>({...i.current,current(){return i.current},previous(){return R.current}}),m=()=>({...p,matches(...n){return n.includes(p.ref.current)},hasTag(n){var e,r;return!!((r=(e=t.states[p.ref.current])==null?void 0:e.tags)!=null&&r.includes(n))}}),M=ut(((_=t.refs)==null?void 0:_.call(t,{prop:g,context:y}))??{}),N=()=>({state:m(),context:y,event:l(),prop:g,send:F,action:L,guard:$,track:ot,refs:M,computed:z,flush:W,scope:c,choose:D}),L=n=>{const e=w(n)?n(N()):n;if(!e)return;const r=e.map(u=>{var v,S;const a=(S=(v=t.implementations)==null?void 0:v.actions)==null?void 0:S[u];return a||U(`[zag-js] No implementation found for action "${JSON.stringify(u)}"`),a});for(const u of r)u==null||u(N())},$=n=>{var e,r;return w(n)?n(N()):(r=(e=t.implementations)==null?void 0:e.guards)==null?void 0:r[n](N())},A=n=>{const e=w(n)?n(N()):n;if(!e)return;const r=e.map(a=>{var S,x;const v=(x=(S=t.implementations)==null?void 0:S.effects)==null?void 0:x[a];return v||U(`[zag-js] No implementation found for effect "${JSON.stringify(a)}"`),v}),u=[];for(const a of r){const v=a==null?void 0:a(N());v&&u.push(v)}return()=>u.forEach(a=>a==null?void 0:a())},D=n=>et(n).find(e=>{let r=!e.guard;return nt(e.guard)?r=!!$(e.guard):w(e.guard)&&(r=e.guard(N())),r}),z=n=>{h(t.computed,()=>"[zag-js] No computed object found on machine");const e=t.computed[n];return e({context:y,event:l(),prop:g,refs:M,scope:c,computed:z})},p=T(()=>({defaultValue:t.initialState({prop:g}),onChange(n,e){var u,a,v,S;if(e){const x=C.current.get(e);x==null||x(),C.current.delete(e)}e&&L((u=t.states[e])==null?void 0:u.exit),L((a=V.current)==null?void 0:a.actions);const r=A((v=t.states[n])==null?void 0:v.effects);if(r&&C.current.set(n,r),e===j){L(t.entry);const x=A(t.effects);x&&C.current.set(j,x)}L((S=t.states[n])==null?void 0:S.entry)}})),O=s.useRef(void 0),k=s.useRef(q.NotStarted);Y(()=>{queueMicrotask(()=>{const r=k.current===q.Started;k.current=q.Started,f(r?"rehydrating...":"initializing...");const u=O.current??p.initial;p.invoke(u,r?p.get():j)});const n=C.current,e=p.ref.current;return()=>{f("unmounting..."),O.current=e,k.current=q.Stopped,n.forEach(r=>r==null?void 0:r()),C.current=new Map,V.current=null,queueMicrotask(()=>{L(t.exit)})}},[]);const G=()=>"ref"in p?p.ref.current:p.get(),F=n=>{queueMicrotask(()=>{var S,x;if(k.current!==q.Started)return;R.current=i.current,i.current=n;let e=G();const r=((S=t.states[e].on)==null?void 0:S[n.type])??((x=t.on)==null?void 0:x[n.type]),u=D(r);if(!u)return;V.current=u;const a=u.target??e;f("transition",n.type,u.target||e,`(${u.actions})`);const v=a!==e;v?P.flushSync(()=>p.set(a)):u.reenter&&!v?p.invoke(e,e):L(u.actions??[])})};return(B=t.watch)==null||B.call(t,N()),{state:m(),send:F,context:y,prop:g,scope:c,refs:M,computed:z,event:l(),getStatus:()=>k.current}}function Z(t){const o=s.useRef(t);return o.current=t,o}function st(t){const o=Z(t);return function(f){return o.current[f]}}function W(t){queueMicrotask(()=>{P.flushSync(()=>t())})}var Rt=rt(t=>t);export{dt as a,vt as b,gt as c,Rt as n,P as r,it as u};
